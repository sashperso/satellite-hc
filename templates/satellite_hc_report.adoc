= Satellite Health Check Report

For Satellite server *{{ ansible_fqdn }}* at {{ ansible_date_time.time }} on {{ ansible_date_time.date }}.

== Analysis

=== Health Check Overview:
----
{{ result_health_check.stdout }}
----

=== Satellite Service Status:
----
{{ result_running_services.stdout }}
----

== Satellite Configuration

=== Satellite System Details
|=======
|*Investigation:*| Gather key facts about the Satellite server 
|*Guidance:*| #TODO#
|*Rationale:*| To ensure Satellite has sufficient resources to run efficiently
|=======

*Observation:*

Base Operating System details:
----
- Hostname:         {{ ansible_fqdn }}
- Operating System: {{ facter_os['distro']['description'] }}
- IP Address:       {{ ansible_default_ipv4['address'] }}
- Kernel Version:   {{ facter_kernelrelease }}
- Uptime:           {{ facter_system_uptime['uptime'] }}
----

CPUs:
----
- Sockets:		{{ ansible_processor_count }}
- Cores per socket:	{{ ansible_processor_cores }}
- Threads per core:	{{ ansible_processor_threads_per_core }}
----

Memory details:
----
- Total:        {{ facter_memory['system']['total'] }}
- Used:         {{ facter_memory['system']['used'] }}
- Swap total:   {{ facter_memory['swap']['total'] }}
- Swap used:    {{ facter_memory['swap']['used'] }}
----

Disk details:
----
{{ result_disk_space.stdout_lines | to_nice_yaml }}
----


=== Satellite and Capsule Architecture
|=======
|*Investigation:*| List the names and urls of the Satellite and Capsule servers. List the organisations linked to the Satellite and Capsule servers.
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|=======
*Observation:*

.Satellites/Capsules:
----
{{ result_capsule_list.stdout }}
----
.Organisations:
----
{{ result_organization_list.stdout }} 
----

NOTE: For more information on a given organisation, run `hammer organization info --id <id_number>`

.Locations:
----
{{ result_hammer_location.stdout }}
----

=== Satellite Version 
|======
|*Investigation:*| What is the currently installed Satellite version on the Satellite server and the capsules? What was the initial installation version?
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|======

*Observation:* 

{{ result_satellite_version.stdout | to_nice_yaml }} is installed on the Satellite server.

{% if result_capsule_version.failed == false %}
{{ result_capsule_version.stdout | to_nice_yaml }} is installed on the Capsule server.
{% else %}
Package satellite-capsule is not installed on the Capsule Server.
{% endif %}


== Infrastructure

=== Firewalls and Proxy
|=====
|*Investigation:*| Is firewalling appropriately configured for the Satellite and Capsule servers? Is the proxy server able to access cdn.redhat.com and subscription.rhsm.redhat.com directly without SSL termination? Are the required ports open? Are any optional ports opened?

|*Guidance:*| #TODO#
|*Rationale:*| If all Satellite services are enabled and running, the following ports should be open on the firewall.

- 80/tcp
- 443/tcp
- 5000/tcp
- 5647/tcp
- 8000/tcp
- 8140/tcp
- 8443/tcp
- 9090/tcp
- 53/tcp
- 53/udp
- 67/udp
- 69/udp

|=====

*Observation:* 

The following ports are enabled by firewalld:
---- 
{{ result_firewall_ports.stdout | to_nice_yaml }}
----

=== Network Requirements
|=====
|*Investigation:*| Network connectivity between Satellite and its capsules needs to be reliable. Can Satellite connect to CDN without issue? Do the FQDN, Domain, and Shortname connections resolve?
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|=====
*Observation:*


The results show the ping test isn't really proving anything. The investigation is 'do the FQDN, Domain, and Shortname connections resolve' so we should query DNS first

.Ping results:
----
{{ result_ping.stdout_lines | to_nice_yaml }}
----
.CDN Connection:

Access to CDN is an arbitary thing .. what if this is a disconnected or air-gapped deployment
----
{{ result_cdn_conn.stdout_lines | to_nice_yaml }}
----

.Listening Ports
The following TCP ports are actively listening:
---- 
{{ ansible_facts['tcp_listen'] | map(attribute='port') | unique | sort | list | to_nice_yaml }}
----

The following UDP ports are actively listening:
---- 
{{ ansible_facts['udp_listen'] | map(attribute='port') | unique | sort | list | to_nice_yaml }}
----

=== Custom Hierarchies
|=====
|*Investigation:*| #TODO#
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|=====
*Observation:* #TODO#



== Storage

=== Pulp Storage
|=====
|*Investigation:*| Where does Pulp data exist and is there sufficient space?
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|=====
*Observation:*


=== Qpidd Storage
|=====
|*Investigation:*| Is the qpidd service available? How much space is available in the qpidd partition? is the qpidd parititon too large?
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|=====
*Observation:*

{% if result_qpidd_status.failed == false %}
{{ result_qpidd_status.stdout | to_nice_yaml }}
{% else %}
{{ result_qpidd_status.stderr_lines | to_nice_yaml }}
{% endif %}

{% if result_qpidd_status.failed == false %}
{{ result_qpidd_storage.stdout | to_nice_yaml }}
{% else %}
{{ result_qpidd_storage.stderr_lines | to_nice_yaml }}
{% endif %}


=== Backup/Restore Procedures
|=====
|*Investigation:*| If the client is using snapshots, what are the backups listed in foreman-maintain backups? What kinds of backup procedures are in place for the Satellite? The consultant will likely have to ask the client for additional information on procedures and backup philosophy.
|*Observation:*| #CONSULTANT TODO#
|*Guidance:*| #CONSULTANT TODO#
|*Rationale:*| #CONSULTANT TODO#
|=====


== Host Management

=== Remote Execution
|=====
|*Investigation:*| Is remote execution set up on Satellite? Is cron used to execute these remote jobs?
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|=====
*Observation:*
----
{{ result_remote_execution.stdout_lines | to_nice_yaml }}
----

=== Provisioning
|=====
|*Investigation:*| #TODO#
|*Observation:*| #CONSULTANT TODO#
|*Guidance:*| #CONSULTANT TODO#
|*Rationale:*| #CONSULTANT TODO#
|=====

=== Errata
|=====
|*Investigation:*| Are errata used? How is Errata managed? What errata are installable on the registered hosts?
|*Guidance:*| #TODO#
|*Rationale:*| As a part of Red Hatâ€™s quality control and release process, we provide customers with updates for each release of official Red Hat RPMs. Red Hat compiles groups of related package into an erratum along with an advisory that provides a description of the update. Security Advisory errata describe fixed security issues found in the package. Bug Fix Advisory errata describes bug fixes, and Product Enhancement Advisory describes enhancements and new features added to the package. 
|=====
*Observation:*

NOTE: The errata variable has been omitted in the report due to size of role. Replace the variable here if you choose to include the role.

== Satellite Management

=== Satellite Logging
|=====
|*Investigation:*| Are any errors logged in the foreman, foreman-proxy, or /var logs? Do any issues tie in with other issues identified in the report?
|*Guidance:*| #TODO#
|*Rationale:*| Any errors that appear in the logs should be investigated to ensure that Satellite is functioning effectively and correctly to avoid bugs and security vulnerabilities. 
|=====
*Observation:*

+ /var/log/foreman/production.log returns:
----
{% if result_production_log.failed == false %}
{{ result_production_log.stdout_lines | to_nice_yaml }}
{% else %}
The production.log does not contain any errors.
{% endif %}
----

+ /var/log/foreman-proxy/proxy.log returns:
----
{% if result_proxy_log.failed == false %}
{{ result_proxy_log.stdout_lines | to_nice_yaml }}
{% else %}
The proxy.log does not contain any errors.
{% endif %}
----

+ /var/log/messages returns:
----
{% if result_messages_log.failed == false %}
{{ result_messages_log.stdout_lines | to_nice_yaml }}
{% else %}
The messages log does not contain any errors.
{% endif %}
----

=== Patch Cycles
|=====
|*Investigation:*| #CONSULTANT TODO#
|*Observation:*| #CONSULTANT TODO#
|*Guidance:*| #CONSULTANT TODO#
|*Rationale:*| #CONSULTANT TODO#
|=====

=== Sync Plans
|=====
|*Investigation:*| #TODO#
|*Observation:*| #TODO#
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|=====

=== Activation Keys
|=====
|*Investigation:*| #TODO#
|*Observation:*| #TODO#
|*Guidance:*| #TODO#
|*Rationale:*| #TODO#
|=====

=== Registered hosts

*Investigation:* How many registered hosts are connected to the Satellite? 

*Observation:*
----
{{ result_registered_hosts.stdout_lines | to_nice_yaml }}
----
